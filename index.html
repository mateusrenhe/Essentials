<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 Minute Workout</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com" onerror="alert('CRITICAL ERROR: Tailwind CSS failed to load.\n\n1. Check your internet connection.\n2. Disable AdBlockers for this page.\n3. If on Windows, Right Click the file > Properties > Check \'Unblock\'.')"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>

<div class="hidden 
    text-blue-400 text-blue-500 text-blue-600 
    text-green-400 text-green-500 text-green-600 
    text-indigo-400 text-indigo-500 text-indigo-600 
    text-gray-400 text-gray-500 text-gray-600">
</div>

<body class="bg-gray-800 md:bg-gray-900 text-gray-100 flex justify-center min-h-dvh overflow-hidden md:overflow-auto sm:items-center">

    <main class="w-full max-w-md p-6 sm:p-10 bg-gray-800 text-center flex flex-col justify-around min-h-dvh sm:block sm:min-h-0 sm:rounded-2xl sm:shadow-xl">
        
        <div id="statusEl" class="h-8 text-2xl font-bold uppercase tracking-wider text-blue-500">
            7 Minute Workout
        </div>
        
        <div id="exerciseEl" class="h-16 text-5xl sm:text-4xl font-bold my-4 flex items-center justify-center">
            Get Ready
        </div>

        <div id="timerEl" class="relative w-56 h-56 sm:w-64 sm:h-64 mx-auto my-6 rounded-full shadow-inner flex items-center justify-center bg-gray-700 cursor-default">
            <svg class="w-full h-full" viewBox="0 0 120 120">
                <circle class="text-gray-600" cx="60" cy="60" r="54" fill="none" stroke="currentColor" stroke-width="12" />
                <circle id="progressCircle" class="text-blue-500" cx="60" cy="60" r="54" fill="none"
                    stroke="currentColor" stroke-width="12"
                    transform="rotate(-90 60 60)"
                    stroke-dasharray="339.29" 
                    stroke-dashoffset="339.29" /> 
            </svg>
            
            <div id="timerDisplay" class="absolute text-8xl sm:text-8xl font-black text-indigo-400">10</div>
            
            <div id="pausePlayOverlay" class="absolute inset-0 w-full h-full rounded-full bg-gray-800/90 flex items-center justify-center hidden transition-opacity duration-300">
                <svg id="pauseIcon" class="w-20 h-20 text-blue-400 hidden" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 00-.75.75v12c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75v-12a.75.75 0 00-.75-.75h-2.5zm8 0a.75.75 0 00-.75.75v12c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75v-12a.75.75 0 00-.75-.75h-2.5z" clip-rule="evenodd" /></svg>
                <svg id="playIcon" class="w-20 h-20 text-blue-400 hidden" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" /></svg>
            </div>
        </div>

        <div class="h-14 uppercase">
            <div class="text-lg font-semibold text-gray-400 tracking-wide">Next Up:</div>
            <div id="nextExerciseEl" class="text-2xl font-bold">Jumping Jacks</div>
        </div>

        <button id="startButton" class="w-full p-4 mt-6 bg-blue-500 text-white rounded-lg text-xl font-bold uppercase hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-800 transition-all duration-300 transform active:scale-95">
            Start Workout
        </button>

    </main>

    <div id="messageBox" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
            <h3 id="messageTitle" class="text-lg font-bold mb-4">Message</h3>
            <p id="messageText" class="text-gray-300 mb-6">This is a message.</p>
            <button id="messageCloseButton" class="w-full px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-800">OK</button>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            
            const statusEl = document.getElementById('statusEl');
            const exerciseEl = document.getElementById('exerciseEl');
            const timerDisplay = document.getElementById('timerDisplay');
            const timerEl = document.getElementById('timerEl');
            const nextExerciseEl = document.getElementById('nextExerciseEl');
            const startButton = document.getElementById('startButton');
            const pausePlayOverlay = document.getElementById('pausePlayOverlay');
            const pauseIcon = document.getElementById('pauseIcon');
            const playIcon = document.getElementById('playIcon');
            const progressCircle = document.getElementById('progressCircle');

            const messageBox = document.getElementById('messageBox');
            const messageTitle = document.getElementById('messageTitle');
            const messageText = document.getElementById('messageText');
            const messageCloseButton = document.getElementById('messageCloseButton');

            function showMessage(title, text) {
                messageTitle.textContent = title;
                messageText.textContent = text;
                messageBox.classList.remove('hidden');
            }
            
            messageCloseButton.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });

            let audioContext;
            let isAudioReady = false;

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                isAudioReady = (audioContext.state === 'running');
            } catch (e) {
                console.error("Web Audio API not supported", e);
                showMessage("Audio Error", "Your browser does not support Web Audio.");
                startButton.disabled = true;
                startButton.textContent = "Audio Not Supported";
            }

            async function unlockAudio() {
                if (isAudioReady) return;
                try {
                    await audioContext.resume();
                    isAudioReady = true;
                } catch (e) { console.warn(e); }
            }
            
            const EXERCISES = ["Jumping Jacks","Wall Sit","Push-ups","Abdominal Crunch","Step-up Chair","Squats","Triceps Dip Chair","Plank","High Knees","Lunges","Push-up Rotation","Side Plank"];
            const READY_TIME = 10;
            const WORK_TIME = 30;
            const REST_TIME = 10;
            const CIRCLE_CIRCUMFERENCE = 339.29;

            let workoutSequence = [];
            let currentExerciseIndex = 0;
            let timer = null;
            let timeLeft = 0;
            let isPaused = false;
            let isStarted = false;

            async function handleStartPauseClick() {
                if (!isAudioReady) {
                    await unlockAudio();
                    if (!isAudioReady) {
                        showMessage("Audio Error", "Please click the screen once to enable audio.");
                        return;
                    }
                }
                if (!isStarted) {
                    playWorkoutStartChime();
                    startWorkout();
                } else {
                    togglePause();
                }
            }

            function createWorkoutSequence() {
                workoutSequence = [];
                workoutSequence.push({ type: 'ready', name: 'Get Ready', duration: READY_TIME });
                EXERCISES.forEach((exercise, index) => {
                    workoutSequence.push({ type: 'work', name: exercise, duration: WORK_TIME });
                    if (index < EXERCISES.length - 1) {
                        workoutSequence.push({ type: 'rest', name: 'Rest', duration: REST_TIME });
                    }
                });
                workoutSequence.push({ type: 'complete', name: 'Workout Complete!', duration: 0 });
            }

            function startWorkout() {
                isStarted = true;
                isPaused = false;
                currentExerciseIndex = 0;
                clearInterval(timer);
                createWorkoutSequence();
                loadExercise(currentExerciseIndex);
                startTimer();
                startButton.textContent = "Pause";
                pausePlayOverlay.classList.add('hidden');
                pauseIcon.classList.add('hidden');
                playIcon.classList.remove('hidden');
            }

            function loadExercise(index) {
                const current = workoutSequence[index];
                const next = workoutSequence[index + 1] || { name: "All Done!" };
                timeLeft = current.duration;
                statusEl.textContent = "7 Minute Workout";
                exerciseEl.textContent = current.name;
                nextExerciseEl.textContent = next.name;
                updateColors(current.type);
                resetTimerDisplay(); 

                if (current.type === 'complete') {
                    startButton.textContent = "Start Over?";
                    playCompleteChime();
                    isStarted = false;
                    clearInterval(timer);
                    pausePlayOverlay.classList.remove('hidden');
                    pauseIcon.classList.remove('hidden');
                    playIcon.classList.add('hidden');
                }
            }
            
            function startTimer() {
                clearInterval(timer);
                tick();
                timer = setInterval(tick, 1000);
            }

            function tick() {
                if (timeLeft <= 0) {
                    handleTimerEnd();
                    return;
                }
                timerDisplay.textContent = timeLeft;
                const current = workoutSequence[currentExerciseIndex];
                const progress = Math.min(1, (current.duration - (timeLeft - 1)) / current.duration);
                const offset = CIRCLE_CIRCUMFERENCE * (1 - progress);
                progressCircle.style.transition = 'stroke-dashoffset 1s linear';
                progressCircle.style.strokeDashoffset = offset;

                if (timeLeft - 1 <= 2 && timeLeft - 1 >= 0) playCountdownBeep();
                timeLeft--;
            }
            
            function handleTimerEnd() {
                clearInterval(timer);
                currentExerciseIndex++;
                if (currentExerciseIndex < workoutSequence.length) {
                    if (workoutSequence[currentExerciseIndex].type !== 'complete') playStartBeep();
                    loadExercise(currentExerciseIndex);
                    if (workoutSequence[currentExerciseIndex].type !== 'complete') setTimeout(startTimer, 50);
                }
            }

            function togglePause() {
                if (!isStarted || workoutSequence[currentExerciseIndex].type === 'complete') return;
                isPaused = !isPaused;
                pausePlayOverlay.classList.toggle('hidden', !isPaused);
                pauseIcon.classList.toggle('hidden', !isPaused);
                playIcon.classList.toggle('hidden', isPaused);

                if (isPaused) {
                    startButton.textContent = "Resume";
                    clearInterval(timer);
                    const computedOffset = window.getComputedStyle(progressCircle).strokeDashoffset;
                    progressCircle.style.transition = 'none';
                    progressCircle.style.strokeDashoffset = computedOffset;
                    void progressCircle.offsetWidth;
                } else {
                    startButton.textContent = "Pause";
                    setTimeout(startTimer, 50);
                }
            }

            function resetTimerDisplay() {
                timerDisplay.textContent = timeLeft;
                progressCircle.style.transition = 'none';
                progressCircle.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE;
                void progressCircle.offsetWidth;
            }

            function updateColors(type) {
                let colorClass = 'blue';
                let suffix = '400';
                if (type === 'work') colorClass = 'blue';
                if (type === 'rest') colorClass = 'green';
                if (type === 'ready') colorClass = 'indigo';
                if (type === 'complete') { colorClass = 'gray'; suffix = '500'; }

                const elements = [timerDisplay, progressCircle];
                const colors = ['blue', 'green', 'indigo', 'gray'];
                const shades = ['400', '500', '600'];

                elements.forEach(el => {
                    colors.forEach(c => shades.forEach(s => el.classList.remove(`text-${c}-${s}`)));
                    el.classList.add(`text-${colorClass}-${suffix}`);
                });
            }

            function playNote(frequency, duration, type = 'sine') {
                if (!isAudioReady || !audioContext) return;
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(frequency, audioContext.currentTime);
                gain.gain.setValueAtTime(0, audioContext.currentTime);
                gain.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.01);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioContext.destination);
                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + duration);
            }

            function playCountdownBeep() { playNote(880, 0.1, 'sine'); }
            function playStartBeep() { playNote(440, 0.2, 'triangle'); }
            function playCompleteChime() { 
                if (!isAudioReady) return;
                playNote(523.25, 0.3); playNote(659.25, 0.3); playNote(783.99, 0.3); playNote(1046.50, 0.4);
            }
            function playWorkoutStartChime() {
                if (!isAudioReady) return;
                playNote(261.63, 0.2, 'triangle'); playNote(329.63, 0.2, 'triangle'); playNote(392.00, 0.2, 'triangle');
            }
            
            startButton.addEventListener('click', handleStartPauseClick);
            createWorkoutSequence();
            loadExercise(0);
        });
    </script>
</body>
</html>
